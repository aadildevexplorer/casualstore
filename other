import { ShoppingBag } from "lucide-react";
import { useState, useEffect } from "react";
import AOS from "aos";
import "aos/dist/aos.css";

export default function CookieBanner() {
  const [show, setShow] = useState(false);
  useEffect(() => {
    AOS.init({ duration: 800, easing: "ease-out" });
  }, []);

  useEffect(() => {
    const consent = localStorage.getItem("cookieConsent");
    if (!consent) {
      setTimeout(() => {
        setShow(true);
      }, 5000); // reduced to 5s for better UX
    }
  }, []);

  const setConsent = async (type) => {
    localStorage.setItem("cookieConsent", type);
    document.cookie = `cookieConsent=${type}; path=/; max-age=${
      60 * 60 * 24 * 30
    }`;
    try {
      await fetch("https://zylomart-3bzq.onrender.com/set-consent", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ consent: type }),
      });
    } catch (error) {
      console.error("Error saving consent:", error);
    }
    setShow(false);
  };

  const resetConsent = () => {
    localStorage.removeItem("cookieConsent");
    document.cookie = "cookieConsent=; path=/; max-age=0";
    setShow(true);
  };

  if (!show) return null;

  return (
    <div
      data-aos="zoom-in"
      className="fixed inset-0 flex items-center justify-center md:items-end md:justify-end md:bottom-6 md:right-6 w-full h-full z-50"
    >
      <div className="w-[90%] max-w-md bg-gradient-to-r from-white via-gray-50 to-white rounded-xl shadow-2xl border border-gray-200 p-6 flex flex-col gap-4 transition-all duration-500 relative">
        {/* Header */}
        <p className="text-lg font-semibold text-gray-900 flex items-center gap-2">
          <ShoppingBag className="w-6 h-6 text-teal-500 animate-bounce" />
          Your Shopping Experience Matters!
        </p>

        {/* Content */}
        <p className="text-sm text-gray-900">
          We use cookies to give you the{" "}
          <span className="font-semibold">
            best personalized shopping experience
          </span>
          , including product recommendations, cart retention, and special
          offers. By clicking "Accept All", you agree to the use of all cookies.
          You can also choose "Essential Only" to continue with a basic
          experience.
        </p>

        {/* Buttons */}
        <div className="flex gap-3 mt-2">
          <button
            onClick={() => setConsent("all")}
            className="bg-gradient-to-r from-teal-400 to-teal-600 text-white px-5 py-2 rounded-full font-medium text-sm hover:from-teal-500 hover:to-teal-700 transition shadow-lg"
          >
            Accept All Cookies
          </button>
          <button
            onClick={() => setConsent("essential")}
            className="bg-gradient-to-r from-blue-500 to-blue-700 text-white px-5 py-2 rounded-full font-medium text-sm hover:from-blue-600 hover:to-blue-800 transition shadow-lg"
          >
            Only Essential
          </button>
        </div>

        {/* Close button */}
        <button
          onClick={resetConsent}
          className="absolute top-3 right-3 text-gray-400 hover:text-gray-600 text-xl font-bold"
        >
          âœ•
        </button>
      </div>
    </div>
  );
}
